<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="canonical" href="http://127.0.0.1:8000/trading_sys/">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>trading_sys - quick_trade</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "trading_sys";
    var mkdocs_page_input_path = "trading_sys.md";
    var mkdocs_page_url = "/trading_sys/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
<script type="text/javascript">(function(){var s=document.createElement("script");var port=(window.location.port || (window.location.protocol == 'https:' ? 443: 80));s.src="//"+window.location.hostname+":"+port+ "/livereload.js?port=" + port;document.head.appendChild(s);})();</script></head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> quick_trade</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">documentation</span></p>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">trading_sys</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#patternfinder">PatternFinder</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#set_client">set_client</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#kalman_filter">kalman_filter</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#scipy_filter">scipy_filter</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#bull_power">bull_power</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#tema">tema</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#linear_">linear_</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#get_stop_take">get_stop_take</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#strategy_diff">strategy_diff</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#strategy_n_ema-strategy_n_sma">strategy_N_ema / strategy_N_sma</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#strategy_macd">strategy_macd</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#strategy_exp_diff">strategy_exp_diff</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#strategy_rsi">strategy_rsi</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#strategy_macd_rsi">strategy_macd_rsi</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#strategy_parabolic_sar">strategy_parabolic_SAR</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#strategy_macd_histogram_diff">strategy_macd_histogram_diff</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#get_network_regression">get_network_regression</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#strategy_regression_model">strategy_regression_model</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#get_trained_network">get_trained_network</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#strategy_with_network">strategy_with_network</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#inverse_strategy">inverse_strategy</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#basic_backtest">basic_backtest</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#set_pyplot">set_pyplot</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#strategy_collider">strategy_collider</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#get_trading_predict">get_trading_predict</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#realtime_trading">realtime_trading</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#log_deposit-log_data">log_deposit / log_data</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#backtest">backtest</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#load_model">load_model</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#prepare_scaler">prepare_scaler</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#find_n">find_N</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#strategy_random_pred">strategy_random_pred</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#is_doji">is_doji</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#convert_signal">convert_signal</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#tradingclient">TradingClient</a>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../utils/">utils</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../install/">install</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../about/">About</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">quick_trade</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>documentation &raquo;</li>
        
      
    
    <li>trading_sys</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="trading_sys">trading_sys:</h1>
<p>The main file of quick_trade.</p>
<h2 id="patternfinder">PatternFinder</h2>
<ul>
<li>A class in which you can test and create trading strategies following these rules:<ul>
<li>exit from the deal - 2.</li>
<li>buy - 1.</li>
<li>sell - 0.</li>
<li>the output of the strategy function has a list format:<ul>
<li>[... 1, 1, 1, 0, 0, 1, 1, 1, 2, 2, 2, 0, 0 ...]</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code>df = yf.download(TICKER, period='5y', interval='1d')
trader = PatternFinder(TICKER, 0, df=df, interval='1d')  #  please, use your df
</code></pre>

<h3 id="set_client">set_client</h3>
<p>This must be run for
get_trading_predict and realtime_trading.
This method must be passed a class inherited
from TradingClient.</p>
<h3 id="kalman_filter">kalman_filter</h3>
<p>A method that returns the closure data to which the kalman filter has been applied N times.
Ret type: pd.DataFrame</p>
<pre><code>trader.set_pyplot()
filtered = trader.scipy_filter()
trader.strategy_diff(filtered)
</code></pre>

<h3 id="scipy_filter">scipy_filter</h3>
<p>A method that returns the closure data to which the scipy.signal.savgol_filter filter has been applied.
Ret type: pd.DataFrame</p>
<pre><code>trader.set_pyplot()
filtered = trader.kalman_filter()
trader.strategy_diff(filtered)
</code></pre>

<h3 id="bull_power">bull_power</h3>
<p>Bull power indicator.
Ret type: np.array</p>
<pre><code>filtered = trader.bull_power(900)
trader.strategy_diff(filtered)
</code></pre>

<h3 id="tema">tema</h3>
<p>Triple exponential moмing averageю.
Ret type: pd.DataFrame</p>
<pre><code>filtered = trader.tema(70)
trader.strategy_diff(filtered)
</code></pre>

<h3 id="linear_">linear_</h3>
<p>A function to get linear data from an argument.
Ret type: np.array</p>
<h3 id="get_stop_take">get_stop_take</h3>
<p>Converts take profit and stop loss from points to specific numbers.
It uses self.stop_loss, self.open_price, self.take_profit and signal.
Ret type: dict</p>
<pre><code>{'stop': stop_loss,
'take': take_profit}
</code></pre>

<h3 id="strategy_diff">strategy_diff</h3>
<p>Strategy based on changing the input data (pd.DataFrame).
Ret type: list of predicts.</p>
<pre><code>trader.strategy_diff(trader.df['Close'])
</code></pre>

<h3 id="strategy_n_ema-strategy_n_sma">strategy_N_ema / strategy_N_sma</h3>
<p>Moving average strategy.</p>
<p><img alt="image" src="https://i.ibb.co/VDDQYJR/IMG-5583.jpg" /></p>
<h3 id="strategy_macd">strategy_macd</h3>
<p>MACD strategy. MACD, MACD signal</p>
<p><img alt="image" src="https://i.ibb.co/s1fLBrG/2020-08-03-18-31-14.png" /></p>
<h3 id="strategy_exp_diff">strategy_exp_diff</h3>
<p>Strategy_diff from tema of close.</p>
<h3 id="strategy_rsi">strategy_rsi</h3>
<p>RSI strategy.</p>
<div align="left">
  <img src="https://i.ibb.co/hBvCXtQ/IMG-5588.jpg" width=900">
</div>

<p>and:
<div align="left">
  <img src="https://i.ibb.co/RDvfVZT/IMG-5586.jpg" width=900">
</div></p>
<h3 id="strategy_macd_rsi">strategy_macd_rsi</h3>
<p>if macd &gt; 0 and rsi &gt; N : buy.</p>
<p>if macd &lt; 0 and rsi &lt; N : sell.</p>
<h3 id="strategy_parabolic_sar">strategy_parabolic_SAR</h3>
<p>PSAR strategy</p>
<h3 id="strategy_macd_histogram_diff">strategy_macd_histogram_diff</h3>
<p>Based on MACD histogram.</p>
<p><img alt="image" src="https://i.ibb.co/8YncjYN/IMG-5590.jpg" /></p>
<h3 id="get_network_regression">get_network_regression</h3>
<p>A method that creates a neural network for regression.
Based on https://medium.com/@randerson112358/stock-price-prediction-using-python-machine-learning-e82a039ac2bb</p>
<h3 id="strategy_regression_model">strategy_regression_model</h3>
<p>A method that creates a series of neural network predictions from closure data.
After that, the method produces strategy_diff and returns a
tuple of predictions for trading and neural network predictions.</p>
<pre><code>TICKER = 'EUR=X'
df = yf.download(TICKER)
trader = PatternFinder(TICKER, 0, df=df, interval='1d')
trader.set_pyplot()
trader.load_model('../model-regression')
trader.strategy_regression_model()
</code></pre>

<p>or</p>
<pre><code>TICKER = 'EUR=X'
df = yf.download(TICKER)
trader = PatternFinder(TICKER, 0, df=df, interval='1d')
trader.set_pyplot()
trader.get_network_regression([df])
trader.strategy_regression_model()
</code></pre>

<h3 id="get_trained_network">get_trained_network</h3>
<p>A method that creates a trained neural network for predictions consisting of buy, sell, exit.
The neural network receives data from ta.add_all_ta_features (my_df, fill_na = True).</p>
<p>trading predictions are based on the Kalman or scipy filter that smoothes the data (and scaled ta.add_all_ta_features()).</p>
<pre><code>TICKER = 'EUR=X'
df = yf.download(TICKER)
trader = PatternFinder(TICKER, 0, df=df, interval='1d')
trader.set_pyplot()
trader.get_trained_network([df])
trader.strategy_with_network()
</code></pre>

<h3 id="strategy_with_network">strategy_with_network</h3>
<p>Strategy using a neural network made by the get_trained_network method.</p>
<h3 id="inverse_strategy">inverse_strategy</h3>
<p>Inverts signals in self.returns.</p>
<pre><code>- buy - sell
- sell - buy
- exit - exit
</code></pre>

<h3 id="basic_backtest">basic_backtest</h3>
<p>Makes a backtest of the strategy, taking into account your parameters.
Returns pd.DataFrame with all metadata.
The console displays data containing information about the deposit.</p>
<h3 id="set_pyplot">set_pyplot</h3>
<p>To set plotly subplots 2x1</p>
<h3 id="strategy_collider">strategy_collider</h3>
<p>Colliding 2 strategies.
standard mode:</p>
<pre><code>[1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 2]
[2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 2, 2, 2, 2, 2, 2, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 0, 0, 0]
                                                                  to this
[2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 0, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2]
</code></pre>

<p>maximalist mode:</p>
<pre><code>[1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 2]
[2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 2, 2, 2, 2, 2, 2, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 0, 0, 0]
                                                                  to this
[2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
</code></pre>

<p>super mode:</p>
<pre><code>[1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 2]
[2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 2, 2, 2, 2, 2, 2, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 0, 0, 0]
                                                                  to this
[2, 2, 2, 2, 2, 2, 0, 0, 1, 1, 2, 2, 2, 2, 0, 0, 1, 2, 1, 0, 0, 0, 2, 0, 0, 0, 1, 1, 2, 2, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2]
</code></pre>

<p>example of the code:</p>
<pre><code>TICKER = 'EUR=X'
df = yf.download(TICKER)
trader = PatternFinder(TICKER, 0, df=df, interval='1d')
trader.set_pyplot()
trader.returns = [1,1,1,1,1,1,0,0,0,0,2,2,2,2,2,2,2,1,1,1,1,1,1,0,0,0,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,2]
ret2 = [2,2,2,2,2,2,2,2,1,1,1,1,1,1,0,0,1,0,1,0,0,0,2,2,2,2,2,2,0,0,0,0,0,0,1,1,1,1,2,2,2,2,2,2,0,0,0]
trader.strategy_collider(args_first_func=(trader.returns,), args_second_func=(ret2,), mode='super')
</code></pre>

<h3 id="get_trading_predict">get_trading_predict</h3>
<p>Getting the trading predict based on current returnsю</p>
<h3 id="realtime_trading">realtime_trading</h3>
<p>To trading on real-time.</p>
<h3 id="log_deposit-log_data">log_deposit / log_data</h3>
<p>Log X-axis on data/depositю</p>
<h3 id="backtest">backtest</h3>
<p>Similar to a basic_backtest, but a candlestick deposit.</p>
<h3 id="load_model">load_model</h3>
<p>Loading model from path.</p>
<h3 id="prepare_scaler">prepare_scaler</h3>
<p>If you are using a loaded neural network,
you need to prepare a scaler suitable for the perception of the neural network.</p>
<h3 id="find_n">find_N</h3>
<p>Strategy using trading patterns.</p>
<h3 id="strategy_random_pred">strategy_random_pred</h3>
<p>This strategy produces random results.</p>
<h3 id="is_doji">is_doji</h3>
<p>Returns a list from T / F. If the opening
price of the candlestick is equal to the closing price, then this is Doji (True)</p>
<h3 id="convert_signal">convert_signal</h3>
<p>A method that replaces signal №1 with signal №2</p>
<h2 id="tradingclient">TradingClient</h2>
<p>This class is needed for receiving data and trading,
if you want to trade on your system and receive data
not from binance, inherit this class and change the
code in your class for your system.</p>
<pre><code>class TradingClient(Client):
    ordered = False

    def get_ticker_price(self, ticker):
        return float(self.get_symbol_ticker(symbol=ticker)['price'])

    def get_data(self, ticker=None, interval=None, **get_kw):
        return get_binance_data(ticker, interval, **get_kw)

    def new_order_buy(self, ticker=None, quantity=None, credit_leverage=None):
        self.__side__ = 'Buy'
        self.quantity = quantity
        self.ticker = ticker
        self.order = self.order_market_buy(symbol=ticker, quantity=quantity)
        self.order_id = self.order['orderId']
        self.ordered = True

    def new_order_sell(self, ticker=None, quantity=None, credit_leverage=None):
        self.__side__ = 'Sell'
        self.quantity = quantity
        self.ticker = ticker
        self.order = self.order_market_sell(symbol=ticker, quantity=quantity)
        self.order_id = self.order['orderId']
        self.ordered = True

    def exit_last_order(self):
        if self.ordered:
            if self.__side__ == 'Sell':
                self.new_order_buy(self.ticker, self.quantity)
            elif self.__side__ == 'Buy':
                self.new_order_sell(self.ticker, self.quantity)
            self.__side__ = 'Exit'

    def get_balance_ticker(self, ticker):
        for asset in self.get_account()['balances']:
            if asset['asset'] == ticker:
                return float(asset['free'])
</code></pre>

<p>Each of these methods needs to be rewritten for your system.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../utils/" class="btn btn-neutral float-right" title="utils">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href=".." class="btn btn-neutral" title="Home"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href=".." style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../utils/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
